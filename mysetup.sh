#!/bin/bash

echo "=== MySQL –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö ==="

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –¥–ª—è MySQL
MYSQL_CMD="mysql -u root -p"

# –ú–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π
echo "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
echo "1) –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
echo "2) –£–¥–∞–ª–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
echo "3) –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"
echo "4) –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π MySQL"
echo "5) –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MySQL"
read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–π—Å—Ç–≤–∏—è (1-5): " ACTION

# –î–µ–π—Å—Ç–≤–∏–µ 1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if [[ "$ACTION" == "1" ]]; then
    read -p "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MySQL: " MYSQL_USER
    read -s -p "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –±–µ–∑–ø–∞—Ä–æ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞): " MYSQL_PASS
    echo
    read -p "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: " DB_NAME

    SQL="
    CREATE DATABASE IF NOT EXISTS \`$DB_NAME\`;
    CREATE USER IF NOT EXISTS '$MYSQL_USER'@'localhost' IDENTIFIED BY '$MYSQL_PASS';
    GRANT ALL PRIVILEGES ON \`$DB_NAME\`.* TO '$MYSQL_USER'@'localhost';
    FLUSH PRIVILEGES;
    "
    
    echo "$SQL" | $MYSQL_CMD
    echo "‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö '$DB_NAME' –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å '$MYSQL_USER' —Å–æ–∑–¥–∞–Ω—ã!"

# –î–µ–π—Å—Ç–≤–∏–µ 2: –£–¥–∞–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
elif [[ "$ACTION" == "2" ]]; then
    read -p "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MySQL –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: " MYSQL_USER
    read -p "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: " DB_NAME

    SQL="
    DROP DATABASE IF EXISTS \`$DB_NAME\`;
    DROP USER IF EXISTS '$MYSQL_USER'@'localhost';
    FLUSH PRIVILEGES;
    "
    
    echo "$SQL" | $MYSQL_CMD
    echo "‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö '$DB_NAME' –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å '$MYSQL_USER' —É–¥–∞–ª–µ–Ω—ã!"

# –î–µ–π—Å—Ç–≤–∏–µ 3: –í—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
elif [[ "$ACTION" == "3" ]]; then
    read -p "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: " DB_NAME
    SQL="SHOW TABLES FROM \`$DB_NAME\`;"
    
    echo "$SQL" | $MYSQL_CMD

# –î–µ–π—Å—Ç–≤–∏–µ 4: –í—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π MySQL
elif [[ "$ACTION" == "4" ]]; then
    SQL="SELECT User, Host FROM mysql.user;"
    
    echo "$SQL" | $MYSQL_CMD

# –î–µ–π—Å—Ç–≤–∏–µ 5: –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
elif [[ "$ACTION" == "5" ]]; then
    read -p "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MySQL –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è: " MYSQL_USER
    read -s -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å: " NEW_PASS
    echo
    
    SQL="
    ALTER USER '$MYSQL_USER'@'localhost' IDENTIFIED BY '$NEW_PASS';
    FLUSH PRIVILEGES;
    "
    
    echo "$SQL" | $MYSQL_CMD
    echo "üîë –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è '$MYSQL_USER' —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!"

else
    echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–µ–Ω."
    exit 1
fi
